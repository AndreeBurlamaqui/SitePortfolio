---
import BaseLayout from '../layouts/base-layout.astro'; // Use your shell
import '../styles/global.css';
import ProjectCard from '../components/project-card.astro';
import { getSortedProjects } from '../utils/projects';

// Fetch all collections in one go (Parallel loading)
const [releasedGames, uiStudies, prototypes] = await Promise.all([
  getSortedProjects('released-games'),
  getSortedProjects('ui-studies'),
  getSortedProjects('prototypes')
]);

// Create tabs data
const tabs = [
  { 
    id: 'tab-games', 
    label: 'Released Games', 
    items: releasedGames,
    basePath: 'released-games'
  },
  { 
    id: 'tab-prototypes', 
    label: 'Prototypes', 
    items: prototypes,
    basePath: 'prototypes'
  },
  { 
    id: 'tab-ui', 
    label: 'UI Studies', 
    items: uiStudies,
    basePath: 'ui-studies' 
  }
];
---

<BaseLayout title="AndrÃ©e Burlamaqui - Portfolio">
  
  <div class="main-container">

    <main class="content-area">

      <div class="tabs-header">
        {tabs.map((tab, index) => (
          <button 
            class={`tab-btn ${index === 0 ? 'active' : ''}`} 
            data-target={tab.id}
          >
            {tab.label}
            <span class="count">{tab.items.length}</span>
          </button>
        ))}
      </div>
      
      {tabs.map((tab, index) => (
        <div id={tab.id} class={`tab-content ${index === 0 ? 'active' : ''}`}>
          
          {tab.items.length > 0 ? (
            <div class="project-grid">
              {tab.items.map(entry => (
                <ProjectCard entry={entry} basePath={tab.basePath} />
              ))}
            </div>
          ) : (
            /* Empty State Fallback */
            <div class="empty-state">
              <p>No projects in this category yet.</p>
            </div>
          )}

        </div>
      ))}

    </main>

  </div>

</BaseLayout>

<script>
    // Tabs
  const buttons = document.querySelectorAll('.tab-btn');
  const contents = document.querySelectorAll('.tab-content');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'));
      contents.forEach(c => c.classList.remove('active'));

      btn.classList.add('active');

      const targetId = btn.getAttribute('data-target');
      
      if (targetId) {
        document.getElementById(targetId)?.classList.add('active');
      }
    });
  });

</script>

<style>
  /* --- TABS --- */
  .tabs-header {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid #eee;
  }

  .tab-btn {
    background: none;
    border: none;
    font-size: 1.2rem;
    font-weight: 600;
    padding-bottom: 1rem;
    cursor: pointer;
    color: #888;
    position: relative;
    top: 2px; /* Alignment trick */
  }

  .tab-btn:hover { color: #444; }

  /* The Active Tab Style */
  .tab-btn.active {
    color: #000;
    border-bottom: 2px solid #000; /* Black line under active tab */
  }

  /* --- TOGGLE LOGIC --- */
  .tab-content { display: none; } /* Hide by default */
  .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- GRID --- */
  .project-grid {
    display:flex;
    flex-wrap: wrap;
    gap: 2rem;
    /* height: 100%; */
  }


  .card-image {
    height: 160px;
    background-size: cover;
    background-position: center;
    background-color: #ddd;
  }

  .card-info { padding: 1rem; }

  .count {
    font-size: 0.8rem;
    background: #eee;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 6px;
    vertical-align: middle;
    color: #666;
  }

  .tab-btn.active .count {
    background: #000;
    color: #fff;
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: #999;
    font-style: italic;
  }

</style>